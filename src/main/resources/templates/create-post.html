<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Create Post - PanAfricanMail</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
    rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Quill CSS -->
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

  <!-- Quill JS -->
  <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f8f9fa;
      color: #333;
    }

    .tab-active {
      border-bottom: 3px solid #3b82f6;
      color: #3b82f6;
      font-weight: 600;
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <nav class="bg-white shadow-md py-4">
    <div class="container mx-auto px-4 flex justify-between items-center">
      <a href="/" class="navbar-brand flex items-center text-blue-600">
        <i class="fa-solid fa-briefcase-medical mr-2"></i>
        <span>PanAfrican<span class="text-orange-500">Mail</span></span>
      </a>
      <div class="flex items-center space-x-6">
        <a href="/" class="text-gray-700 hover:text-blue-600 transition"><i class="fa-solid fa-home mr-1"></i> Home</a>
        <a href="/create-post" class="text-gray-700 hover:text-blue-600 transition"><i
            class="fa-solid fa-plus mr-1"></i> Create Post</a>
      </div>
    </div>
  </nav>

  <!-- Post Form -->
  <div class="max-w-3xl mx-auto mt-10 bg-white rounded-lg shadow-md p-6">
    <h1 class="text-2xl font-bold mb-6 text-center">Create New Post</h1>

    <!-- Tabs -->
    <div class="flex border-b mb-6">
      <button id="job-tab-btn" class="w-1/2 py-3 text-center font-medium tab-active" onclick="switchPostTab('job')">
        <i class="fa-solid fa-briefcase mr-2"></i> Job Post
      </button>
      <button id="story-tab-btn" class="w-1/2 py-3 text-center font-medium" onclick="switchPostTab('story')">
        <i class="fa-solid fa-book-open mr-2"></i> Story Post
      </button>
    </div>

    <!-- Job Post Form -->
    <div id="job-post-form" class="post-tab">
      <div class="mb-6 bg-yellow-50 border-l-4 border-yellow-400 p-4">
        <p class="text-sm text-yellow-700">
          You need to be logged in to create a job post.
          <a href="/login" class="font-medium underline text-yellow-700 hover:text-yellow-600">Login</a> or
          <a href="/signup" class="font-medium underline text-yellow-700 hover:text-yellow-600">Sign up</a>
        </p>
      </div>

      <form id="job-form">
        <div class="mb-4">
          <label class="block text-sm font-bold mb-1">Job Title *</label>
          <input type="text" required class="w-full border rounded px-3 py-2"
            placeholder="e.g. Senior Software Engineer" name="title" />
        </div>
        <div class="mb-4">
          <label class="block text-sm font-bold mb-1">Company *</label>
          <input type="text" required class="w-full border rounded px-3 py-2" placeholder="e.g. Acme Inc."
            name="company" />
        </div>
        <div class="mb-4 grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-bold mb-1">Location *</label>
            <input type="text" required class="w-full border rounded px-3 py-2" name="location" />
          </div>
          <div>
            <label class="block text-sm font-bold mb-1">Category *</label>
            <select required class="w-full border rounded px-3 py-2" name="category">
              <option value="">Select a category</option>
              <option value="Engineering">Engineering</option>
              <option value="Design">Design</option>
              <option value="Marketing">Marketing</option>
            </select>
          </div>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-bold mb-1">Salary (optional)</label>
          <input type="text" class="w-full border rounded px-3 py-2" name="salary" />
          <input type="hidden" name="type" value="job" />
        </div>
        <div class="mb-4">
          <label class="block text-sm font-bold mb-1">Job Description *</label>

          <!-- Quill container -->
          <div id="job-editor" style="height: 200px;"></div>

          <!-- Hidden input to store HTML -->
          <input type="hidden" name="description" id="jobDescriptionInput" required>
        </div>

        <div class="text-right">
          <button type="submit" class="bg-blue-600 text-white px-5 py-2 rounded">Post Job</button>
        </div>
      </form>
    </div>

    <!-- Story Post Form -->
    <div id="story-post-form" class="hidden post-tab">
      <form id="story-form">
        <div class="mb-4">
          <label class="block text-sm font-bold mb-1">Story Title *</label>
          <input type="text" required class="w-full border rounded px-3 py-2" name="title" />
        </div>
        <div class="mb-4">
          <label class="block text-sm font-bold mb-1">Author Name (Optional)</label>
          <input type="text" class="w-full border rounded px-3 py-2" name="author" />
          <input type="hidden" name="type" value="STORY" />
        </div>
        <div class="mb-4">
          <label class="block text-sm font-bold mb-1">Your Story *</label>

          <!-- Rich text editor container -->
          <div id="editor" style="height: 200px;"></div>

          <!-- Hidden input to store HTML content for form submission -->
          <input type="hidden" name="content" id="contentInput" required>
        </div>

        <div class="text-right">
          <button type="submit" class="bg-orange-500 hover:bg-orange-600 text-white px-5 py-2 rounded">Share
            Story</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white py-8 mt-8">
    <div class="container mx-auto px-4 text-center">
      <p class="text-gray-400">&copy; 2025 PanAfricanMail. All rights reserved.</p>
    </div>
  </footer>

  <!-- Tab Switching Script -->
  <script>
    function switchPostTab(tab) {
      document.getElementById("job-tab-btn").classList.remove("tab-active");
      document.getElementById("story-tab-btn").classList.remove("tab-active");
      document.getElementById("job-post-form").classList.add("hidden");
      document.getElementById("story-post-form").classList.add("hidden");

      if (tab === "job") {
        document.getElementById("job-tab-btn").classList.add("tab-active");
        document.getElementById("job-post-form").classList.remove("hidden");
      } else {
        document.getElementById("story-tab-btn").classList.add("tab-active");
        document.getElementById("story-post-form").classList.remove("hidden");
      }
    }
  </script>

  <!-- Form Submission Scripts -->
  <script>
    // JOB form submission
    document.getElementById("job-form").addEventListener("submit", function (e) {
      e.preventDefault();
      const form = e.target;
      document.getElementById('jobDescriptionInput').value = jobQuill.root.innerHTML;

      const user = {
        jobTitle: form.elements["title"].value,
        company: form.elements["company"].value,
        location: form.elements["location"].value,
        category: form.elements["category"].value,
        salary: form.elements["salary"].value,
        jobDescription: form.elements["description"].value,
        type: "job"
      };

      fetch("/create-post", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(user)
      })
        .then(response => response.text())
        .then(data => {
          Swal.fire("Success!", "Job posted successfully!", "success");
          form.reset();
        })
        .catch(error => {
          console.error("Error:", error);
          Swal.fire("Error", "Failed to post job", "error");
        });
    });

    // STORY form submission
    document.getElementById("story-form").addEventListener("submit", function (e) {
      e.preventDefault();
      const form = e.target;

      // Get Quill HTML into hidden input BEFORE reading it
      document.getElementById('contentInput').value = quill.root.innerHTML;

      const user = {
        title: form.elements["title"].value,
        author: form.elements["author"].value,
        content: form.elements["content"].value,
        type: "STORY"
      };

      fetch("/create-post", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(user)
      })
        .then(response => response.text())
        .then(data => {
          Swal.fire("Success!", "Story shared successfully!", "success");
          form.reset();
          quill.setContents([]); // clear editor
        })
        .catch(error => {
          console.error("Error:", error);
          Swal.fire("Error", "Failed to share story", "error");
        });
    });

  </script>
  <script>
    // Initialize Quill
    var quill = new Quill('#editor', {
      theme: 'snow',
      placeholder: 'Write your story...',
      modules: {
        toolbar: [
          ['bold', 'italic', 'underline', 'strike'],
          [{ 'color': [] }, { 'background': [] }],
          [{ 'header': 1 }, { 'header': 2 }],
          [{ 'list': 'ordered' }, { 'list': 'bullet' }],
          [{ 'align': [] }],
          ['clean']
        ]
      }
    });

    // Ensure Quill HTML is stored before sending story
    document.getElementById('story-form').addEventListener('submit', function () {
      document.getElementById('contentInput').value = quill.root.innerHTML;
    });
  </script>

  <script>
    // Job description Quill editor
    var jobQuill = new Quill('#job-editor', {
      theme: 'snow',
      placeholder: 'Write the job description...',
      modules: {
        toolbar: [
          ['bold', 'italic', 'underline', 'strike'],
          [{ 'color': [] }, { 'background': [] }],
          [{ 'header': 1 }, { 'header': 2 }],
          [{ 'list': 'ordered' }, { 'list': 'bullet' }],
          [{ 'align': [] }],
          ['clean']
        ]
      }
    });

  </script>

</body>

</html>